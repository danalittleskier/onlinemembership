<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:flow="http://www.springframework.org/schema/webflow-config"
       xsi:schemaLocation="
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
           http://www.springframework.org/schema/webflow-config
           http://www.springframework.org/schema/webflow-config/spring-webflow-config-1.0.xsd">

    <!--  URL Handlers -->
    <bean id="urlMapping" class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
        <property name="mappings">
            <value>
                /admin/activeUsers.html=filenameController
                /admin/flushCache.html=filenameController
                /admin/reload.html=reloadController
                /admin/users.html=userController
                /mainMenu.html=filenameController
                /passwordHint.html=passwordHintController

                <!-- USSA Membership mappings -->

                /contact.html=contactController
                /registration.html=registrationController
                /Medical.html=MedicalController
                /MedicalWaiver.html=MedicalWaiverController
                /MembershipInformation.html=MembershipInformationController
                /MembershipInformationShopping.html=MembershipInformationShoppingController
                /MembershipInformationSummary.html=MembershipInformationSummaryController
                /ReleaseWaiver.html=ReleaseWaiverController
                /Verification.html=VerificationController



            </value>
        </property>
        <property name="order" value="0"/>
    </bean>

    <!--  Exception Resolver -->
    <bean id="exceptionResolver" class="org.springframework.web.servlet.handler.SimpleMappingExceptionResolver">
        <property name="exceptionMappings">
            <props>
                <prop key="org.springframework.dao.DataAccessException">
                    dataAccessFailure
                </prop>
            </props>
        </property>
    </bean>

    <bean id="filenameController" class="org.springframework.web.servlet.mvc.UrlFilenameViewController"/>

    <bean id="fileUploadController" class="org.appfuse.webapp.controller.FileUploadController">
        <property name="validator" ref="beanValidator"/>
        <property name="cancelView" value="redirect:mainMenu.html"/>
        <property name="formView" value="uploadForm"/>
        <property name="successView" value="uploadDisplay"/>
    </bean>

    <bean id="passwordHintController" class="org.appfuse.webapp.controller.PasswordHintController">
        <property name="userManager" ref="userManager"/>
        <property name="messageSource" ref="messageSource"/>
        <property name="mailEngine" ref="mailEngine"/>
        <property name="message" ref="mailMessage"/>
    </bean>

    <bean id="reloadController" class="org.appfuse.webapp.controller.ReloadController"/>

    <bean id="signupController" class="org.appfuse.webapp.controller.SignupController">
        <property name="validator" ref="beanValidator"/>
        <property name="formView" value="signup"/>
        <property name="successView" value="redirect:mainMenu.html"/>
        <property name="userManager" ref="userManager"/>
        <property name="roleManager" ref="roleManager"/>
        <property name="mailEngine" ref="mailEngine"/>
        <property name="message" ref="mailMessage"/>
        <property name="templateName" value="accountCreated.vm"/>
    </bean>

    <bean id="userController" class="org.appfuse.webapp.controller.UserController">
        <property name="userManager" ref="userManager"/>
    </bean>

    <bean id="userFormController" class="org.appfuse.webapp.controller.UserFormController">
        <property name="validator" ref="beanValidator"/>
        <property name="formView" value="userForm"/>
        <property name="successView" value="redirect:users.html"/>
        <property name="cancelView" value="redirect:mainMenu.html"/>
        <property name="userManager" ref="userManager"/>
        <property name="roleManager" ref="roleManager"/>
        <property name="mailEngine" ref="mailEngine"/>
        <property name="message" ref="mailMessage"/>
        <property name="templateName" value="accountCreated.vm"/>
    </bean>

    <!-- Add additional USSA controller beans here -->

	<bean id="contactController" class="org.ussa.spring.controller.ContactController">
       <property name="formView" value="contact"/>
       <property name="successView" value="redirect:mainMenu.html"/>
	   <property name="addressDao" ref="addressDao"/>
	   <property name="memberDao" ref="memberDao"/>
	   <property name="memberManager" ref="memberManager"/>
      <property name="validator">
        <bean parent="validatorTemplate">
          <property name="formName" value="contactInfo" />
        </bean>
      </property>
	</bean>
	<bean id="MedicalController" class="org.ussa.spring.controller.MedicalController"/>
	<bean id="MedicalWaiverController" class="org.ussa.spring.controller.MedicalWaiverController"/>
	<bean id="MembershipInformationController" class="org.ussa.spring.controller.MembershipInformationController"/>
	<bean id="MembershipInformationShoppingController" class="org.ussa.spring.controller.MembershipInformationShoppingController"/>
	<bean id="MembershipInformationSummaryController" class="org.ussa.spring.controller.MembershipInformationSummaryController"/>
	<bean id="ReleaseWaiverController" class="org.ussa.spring.controller.ReleaseWaiverController"/>
	<bean id="VerificationController" class="org.ussa.spring.controller.VerificationController"/>


    <bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
        <property name="maxUploadSize" value="2097152"/>
    </bean>

    <bean id="messageSource" class="org.springframework.context.support.ResourceBundleMessageSource">
        <property name="basename" value="ApplicationResources"/>
        <property name="useCodeAsDefaultMessage" value="true"/>
    </bean>

    <bean class="org.springframework.web.servlet.mvc.support.ControllerClassNameHandlerMapping">
        <property name="order" value="1"/>
    </bean>

    <!-- View Resolver for JSPs -->
    <bean id="viewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <property name="requestContextAttribute" value="rc"/>
        <property name="viewClass" value="org.springframework.web.servlet.view.JstlView"/>
        <property name="prefix" value="/WEB-INF/pages/"/>
        <property name="suffix" value=".jsp"/>
    </bean>

	<!-- ====================================== Web Flows ============================================== -->
	<bean name="registrationController" class="org.springframework.webflow.executor.mvc.FlowController">
		<property name="flowExecutor" ref="flowExecutor" />
		<property name="cacheSeconds" value="5" />
		<property name="defaultFlowId" value="registration-flow" />
	</bean>

	<!-- Launches new flow executions and resumes existing executions. -->
	<flow:executor id="flowExecutor" registry-ref="flowRegistry" repository-type="singlekey"/>

	<!-- Creates the registry of flow definitions for this application -->
	<flow:registry id="flowRegistry">
		<flow:location path="/WEB-INF/flows/registration-flow.xml" />
	</flow:registry>

</beans>
